<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nosso Momento</title>
<!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .product-card {
            transition: all 0.3s ease-out;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 53, 71, 0.2);
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.2);
        }
        .product-img {
            height: 160px;
            object-fit: cover;
            width: 100%;
        }
        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 10px;
            border-radius: 32px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .carrinho-item {
            animation: fadeIn 0.5s ease-out;
            border-radius: 12px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-red {
            background: linear-gradient(135deg, #FF3547 0%, #FF6B7C 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 10px 20px rgba(255, 53, 71, 0.3);
            padding: 14px 24px;
            border: none;
            outline: none;
            text-transform: uppercase;
            font-size: 14px;
        }
        .btn-red:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 30px rgba(255, 53, 71, 0.4);
            background: linear-gradient(135deg, #FF4252 0%, #FF7B8A 100%);
        }
        .bg-overlay {
            background-color: rgba(0, 0, 0, 0.8);
        }
        /* Modern button styles */
        .btn-modern {
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        /* Input styles */
        input {
            border-radius: 12px !important;
            padding: 14px 16px !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            background: rgba(255,255,255,0.05) !important;
            color: white !important;
        }
        input::placeholder {
            color: rgba(255,255,255,0.5) !important;
        }
        /* Card styles */
        .card {
            border-radius: 20px;
            background: rgba(30,30,30,0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.05);
        }
    </style>
</head>
<body class="bg-black text-white font-sans">
    <div id="app">
        <!-- Login screen will be rendered here initially -->
    </div>

<!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAppTP2vJuLofr9ueWsK3djbwSeEm5qb2c",
      authDomain: "nosso-momento-app.firebaseapp.com",
      projectId: "nosso-momento-app",
      storageBucket: "nosso-momento-app.firebasestorage.app",
      messagingSenderId: "503855316994",
      appId: "1:503855316994:web:7d5ee171b44c4f8b86a71b",
    };

    // Inicializa√ß√£o do Firebase e Firestore
    firebase.initializeApp(firebaseConfig);
    console.log("‚úÖ Firebase: Initialized com sucesso!");
    const db = firebase.firestore();
  </script>

    <script>
        // Main application state
        const state = {
            usuario: null,
            pareado: false,
            etapa: 'login',
            carrinho: [],
            codigoUsuario: null,       // C√≥digo gerado para o usu√°rio
            codigoDigitando: false,    // Flag para controle da UI
            parceiroCodigo: null,      // C√≥digo do parceiro digitado
            parceiroTelefone: null,    // Telefone do parceiro pareado
            showPartnerInfo: false     // Mostra informa√ß√µes do parceiro
        };

        // Mock storage for matched pairs (in a real app this would be in a backend)
        const pareamentos = {};

        // DOM elements
        const appContainer = document.getElementById('app');

        // Render functions
        function renderLogin() {
            appContainer.innerHTML = `
                <div class="min-h-screen flex flex-col justify-center items-center" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.9)), url('https://images.unsplash.com/photo-1517511620798-cec17d428bc0?auto=format&fit=crop&w=1470&q=80'); background-size: cover; background-position: center;">
                    <div class="card p-10 w-full max-w-md text-white overflow-hidden" style="border-radius: 24px;">
                        <div class="text-center mb-10">
                            <h2 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-red-500 mb-4" style="font-weight: 700;">NOSSO MOMENTO</h2>
                            <p class="text-gray-300 tracking-wider">Apimente a rela√ß√£o.<br>Deixe tudo mais gostoso!</p>
                        </div>
                        <div class="space-y-5">
                            <div>
                                <input id="nome" placeholder="Seu nome" class="w-full bg-gray-800 bg-opacity-50 border border-gray-700 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 rounded-xl py-4 px-5 text-gray-200 placeholder-gray-400 transition-all duration-300" />
                            </div>
                            <div>
                                <input id="email" type="email" placeholder="Email" class="w-full bg-gray-800 bg-opacity-50 border border-gray-700 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 rounded-xl py-4 px-5 text-gray-200 placeholder-gray-400 transition-all duration-300" />
                            </div>
                            <div>
                                <input id="telefone" type="tel" placeholder="Telefone (com DDD)" pattern="[0-9]{11}" required class="w-full bg-gray-800 bg-opacity-50 border border-gray-700 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 rounded-xl py-4 px-5 text-gray-200 placeholder-gray-400 transition-all duration-300" />
                            </div>
                            <div>
                                <input id="senha" type="password" placeholder="Crie uma senha" class="w-full bg-gray-800 bg-opacity-50 border border-gray-700 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 rounded-xl py-4 px-5 text-gray-200 placeholder-gray-400 transition-all duration-300" />
                            </div>
                            <div>
                                <select id="sexo" class="w-full bg-gray-800 bg-opacity-50 border border-gray-700 focus:border-pink-500 focus:ring-2 focus:ring-pink-500/50 rounded-xl py-4 px-5 text-gray-200 placeholder-gray-400 transition-all duration-300">
                                    <option value="" disabled selected>Selecione seu sexo</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Feminino">Feminino</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="handleLogin()" class="btn-red w-full mt-8 py-4 rounded-xl hover:shadow-xl transition-all duration-400 flex items-center justify-center gap-3">
                            <span class="text-lg">COME√áAR AGORA</span>
                            <i class="fas fa-arrow-right-long"></i>
                        </button>
                        <p class="text-center mt-6 text-gray-400 text-sm">
                            Ao continuar, voc√™ concorda com nossos <a href="#" class="text-pink-400 hover:underline">Termos</a> e <a href="#" class="text-pink-400 hover:underline">Pol√≠tica de Privacidade</a>
                        </p>
                    </div>
                </div>
            `;
        }

async function validarCodigo() {
    const codigoDigitado = document.getElementById('codigoParceiro').value;

    if (!codigoDigitado || codigoDigitado.length !== 11) {
        alert('Por favor, digite um n√∫mero de telefone completo com 11 d√≠gitos (com DDD).');
        return;
    }

    const telefoneUsuario = state.usuario.telefone; // exemplo: '11999999999'
    const usuarioDoc = db.collection('usuarios').doc(state.usuario.email);

    try {
        // 1. Atualiza o usu√°rio logado com pareadoCom
        await usuarioDoc.set({
            pareadoCom: codigoDigitado
        }, { merge: true });

        // 2. Busca o documento do parceiro (com base no telefone pareado)
        const parceiroQuery = await db.collection('usuarios')
            .where('telefone', '==', codigoDigitado)
            .limit(1)
            .get();

        if (!parceiroQuery.empty) {
            const parceiroDocRef = parceiroQuery.docs[0].ref;

            // Atualiza o parceiro com o telefone do usu√°rio atual
            await parceiroDocRef.set({
                pareadoCom: telefoneUsuario
            }, { merge: true });
        }

        // 3. Cria/atualiza a collection "pareamentos"
        const telefones = [telefoneUsuario, codigoDigitado].sort();
        const idPareamento = telefones.join('_');

        await db.collection('pareamentos').doc(idPareamento).set({
            pessoa1: telefones[0],
            pessoa2: telefones[1],
            dataPareamento: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert('Perfil pareado com sucesso!');

        state.pareado = true;
        state.etapa = 'main';
        state.parceiroCodigo = codigoDigitado;
        state.parceiroTelefone = '55' + codigoDigitado.replace(/\D/g, '');

        renderMain();

    } catch (error) {
        console.error('Erro ao salvar pareamento nos dois lados:', error);
        alert('Erro ao salvar o pareamento. Tente novamente.');
    }
}


        function renderPareamento() {
            // Usar telefone do usu√°rio como c√≥digo de pareamento (apenas n√∫meros)
            const codigoUsuario = state.usuario.telefone.replace(/\D/g, '');
            
            appContainer.innerHTML = `
                <div class="min-h-screen flex flex-col justify-center items-center bg-black bg-opacity-90 text-white p-8">
                    <div class="card p-8 max-w-md w-full relative overflow-hidden">
                        <div class="absolute -top-20 -right-20 w-40 h-40 rounded-full bg-pink-500 opacity-10"></div>
                        <div class="absolute -bottom-20 -left-20 w-40 h-40 rounded-full bg-red-500 opacity-10"></div>
                        <h2 class="text-3xl font-bold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500">
                            <i class="fas fa-heart mr-2"></i> Pareamento
                        </h2>
                        
                        ${!state.codigoDigitando ? `
                            <div class="text-center mb-6">
                                <p class="mb-4">Seu c√≥digo de pareamento √©:</p>
                                <div class="text-4xl font-bold bg-gray-800 py-3 px-6 rounded-lg inline-block">
                                    ${codigoUsuario}
                                </div>
                                <p class="mt-4 text-sm text-gray-300">Compartilhe este c√≥digo com seu parceiro(a)</p>
                            </div>
                            
                            <div class="mb-6 text-center">
                                <p>OU</p>
                                <p class="mt-2">Digite o c√≥digo do seu parceiro(a)</p>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row justify-center gap-4 sm:gap-6">
                                <button onclick="state.codigoDigitando = true; renderPareamento();" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded text-white font-semibold transition">
                                    Digitar C√≥digo
                                </button>
                                <button onclick="handleContinuarSemParear()" class="btn-red hover:bg-red-600 px-6 py-3 rounded text-white font-semibold transition">
                                    Fazer Isso Depois
                                </button>
                            </div>
                        ` : `
                            <div class="mb-6">
                                <label class="block mb-2">Digite o c√≥digo do seu parceiro(a)</label>
                                <input id="codigoParceiro" type="number" class="w-full p-3 rounded text-black" placeholder="11999991111" maxlength="11" />
                            </div>
                            <div class="flex gap-4">
                                <button onclick="state.codigoDigitando = false; renderPareamento();" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-white font-semibold transition">
                                    Voltar
                                </button>
                                <button onclick="validarCodigo()" class="bg-green-700 hover:bg-green-600 px-6 py-3 rounded text-white font-semibold transition flex-1">
                                    Validar C√≥digo
                                </button>
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            // Atualiza o c√≥digo do usu√°rio no state somente na primeira renderiza√ß√£o
            if (!state.codigoUsuario) {
                state.codigoUsuario = codigoUsuario;
            }
        }

        function renderMain() {
            const categorias = [
                { nome: 'Quentes', emoji: 'ü•µ', color: 'bg-pink-900' },
                { nome: 'Lovezin', emoji: 'üíó', color: 'bg-red-900' },
                { nome: 'Sair da Rotina', emoji: 'üéâ', color: 'bg-purple-900' }
            ];

            const momentos = [
                { nome: 'Mamada Surpresa', categoria: 'Quentes', emoji: 'ü•µ', img: 'https://imagenes.elpais.com/resizer/v2/2ARTSVZFAMOWYEREJ5CC72W4WA.jpg?auth=72d5ccea313b45142dc48ab5509bfa8751331fa78cbbf5cd412413fbc51ba60d&width=414', intensidade: 4 },
                { nome: 'Chupada Surpresa', categoria: 'Quentes', emoji: 'ü•µ', img: 'https://uniqcondoms.com/wp-content/uploads/2024/07/condones-femeninos-sexo-oral.png', intensidade: 4 },
                { nome: 'Sexo Rom√¢ntico', categoria: 'Quentes', emoji: 'ü•µ', img: 'https://us.123rf.com/450wm/4pmproduction/4pmproduction1706/4pmproduction170600453/81004283-lindo-casal-apaixonado-est%C3%A1-se-beijando-na-cama-prel%C3%BAdio-ao-sexo.jpg', intensidade: 4 },
                { nome: 'Sexo Agressivo', categoria: 'Quentes', emoji: 'ü•µ', img: 'https://conteudo.imguol.com.br/c/entretenimento/2d/2016/07/22/voce-conhece-as-preferencias-sexuais-do-seu-par-1469219198036_v2_900x506.jpg', intensidade: 5 },
                { nome: 'C*zinho', categoria: 'Quentes', emoji: 'ü•µ', img: 'https://t4.ftcdn.net/jpg/06/27/26/69/360_F_627266974_C25IGTTKd4Fp2nXhuCDv4dMTlDsxqiWj.jpg', intensidade: 5 },
                { nome: 'Tapa na Bunda', categoria: 'Lovezin', emoji: 'üíó', img: 'https://vemconversar.com.br/wp-content/uploads/2022/10/E-no-olhar-que-tudo-comeca.jpeg', intensidade: 2 },
                { nome: 'Beij√£o', categoria: 'Lovezin', emoji: 'üíó', img: 'https://www.otempo.com.br/content/dam/otempo/editorias/interessa/2024/3/interessa-beijo-de-lingua-beneficios-do-beijo-1713342721.jpeg', intensidade: 1 },
                { nome: '30 Beijinhos', categoria: 'Lovezin', emoji: 'üíó', img: 'https://img.freepik.com/fotos-premium/retrato-em-close-up-de-dois-apaixonados-apaixonados-se-beijando-em-casa_171337-79073.jpg', intensidade: 1 }, 
                { nome: 'Abra√ßo', categoria: 'Lovezin', emoji: 'üíó', img: 'https://us.123rf.com/450wm/peopleimages12/peopleimages122210/peopleimages12221028649/193181819-seu-amor-transformou-meu-mundo-um-jovem-casal-desfrutando-de-algum-tempo-de-qualidade-juntos-na.jpg?ver=6', intensidade: 1 },
                { nome: 'Massagem', categoria: 'Lovezin', emoji: 'üíó', img: 'https://individuale.med.br/wp-content/uploads/2019/08/massagem-anti-stress.png', intensidade: 3 },
                { nome: 'Viajar', categoria: 'Sair da Rotina', emoji: 'üéâ', img: 'https://p2.trrsf.com/image/fget/cf/774/0/images.terra.com/2023/12/07/1581006561-1rdpraia-do-aventureiro-1.jpg', intensidade: 2 },
                { nome: 'Noitada', categoria: 'Sair da Rotina', emoji: 'üéâ', img: 'https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=600&auto=format', intensidade: 2 },
                { nome: 'Pagode', categoria: 'Sair da Rotina', emoji: 'üéâ', img: 'https://s2-g1.glbimg.com/PiT2YdXpDe8AU4vPY3nVopJ3ksM=/0x0:1014x681/984x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_59edd422c0c84a879bd37670ae4f538a/internal_photos/bs/2021/j/p/h577gHSrq8AvQbtKQeBg/roda-de-samba-2.jpg', intensidade: 2 },
                { nome: 'Almo√ßar Fora', categoria: 'Sair da Rotina', emoji: 'üéâ', img: 'https://media.timeout.com/images/106062540/750/422/image.jpg', intensidade: 1 },
                { nome: 'Jantar Fora', categoria: 'Sair da Rotina', emoji: 'üéâ', img: 'https://www.rbsdirect.com.br/filestore/0/7/2/9/4/9/4_1b48f02f18ac345/4949270_5de2a64f5b53f27.jpg?format=webp&w=1600&h=900&a=c', intensidade: 1 }
            ];

            appContainer.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-gray-900 to-black text-white">
                    <!-- Header -->
                    <header class="sticky top-0 z-10 bg-gray-900/80 backdrop-blur-md border-b border-gray-800">
                        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                            <div class="flex items-center gap-1">
                                <div class="relative">
                                    <div class="flex items-center justify-center w-9 h-9 rounded-full bg-gradient-to-br from-pink-500 to-red-600 shadow-lg">
                                        <i class="fas fa-heart-beat text-white text-xs"></i>
                                    </div>
                                    <div class="absolute -top-1 -right-1 w-3 h-3 rounded-full bg-red-400 animate-pulse"></div>
                                </div>
                                <h1 class="text-2xl font-bold">
                                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-red-500 font-extrabold tracking-tight" style="text-shadow: 0 2px 4px rgba(255,53,71,0.3);">NOSSO</span>
                                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-pink-500 font-extrabold tracking-tight" style="text-shadow: 0 2px 4px rgba(255,53,71,0.3);">MOMENTO</span>
                                </h1>
                                <div class="w-2 h-2 rounded-full bg-pink-500 opacity-70 animate-pulse ml-1"></div>
                            </div>
                            <div class="flex items-center gap-4">
                                ${!state.pareado ? `
                                    <button onclick="renderPareamento()" class="text-sm bg-pink-600 hover:bg-pink-700 px-4 py-2 rounded-lg text-white font-medium transition flex items-center gap-2">
                                        <i class="fas fa-heart text-xs"></i> Parear
                                    </button>
                                ` : `
                                    <div class="relative">
                                        <button onclick="state.showPartnerInfo = !state.showPartnerInfo; renderMain()" class="text-sm bg-green-900/60 hover:bg-green-800/60 text-green-400 px-3 py-2 rounded-lg font-medium flex items-center gap-2 transition">
                                            <i class="fas fa-user-heart text-xs"></i> Pareado
                                        </button>
                                        ${state.showPartnerInfo ? `
                                            <div class="absolute right-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-50 p-4">
                                                <div class="flex justify-between items-start mb-2">
                                                    <h4 class="font-medium text-green-400">Parceiro Pareado</h4>
                                                    <button onclick="state.showPartnerInfo = false; renderMain()" class="text-gray-400 hover:text-white">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <p class="text-sm text-gray-300 mb-1">C√≥digo do parceiro:</p> 
                                                <p class="bg-gray-900 px-3 py-1 rounded text-sm mb-4">${state.parceiroCodigo}</p>
                                                <button onclick="desparearParceiro()" class="w-full text-sm bg-red-800 hover:bg-red-700 text-white px-3 py-2 rounded-lg transition">
                                                    Desfazer Pareamento
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                `}
                                <div class="relative">
                                    <button class="flex items-center gap-2 relative" onclick="renderMain(); event.stopPropagation()">
                                        <i class="fas fa-shopping-cart text-lg"></i>
                                        ${state.carrinho.length > 0 ? `
                                            <span class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">
                                                ${state.carrinho.length}/2
                                            </span>
                                        ` : ''}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main class="container mx-auto px-4 py-8">
                        <!-- Hero Section -->
                        <div class="mb-12 text-center">
                            <h2 class="text-3xl md:text-4xl font-bold mb-4">Viva um Momento Hoje</h2>
                            <p class="text-gray-400 max-w-2xl mx-auto">
                                Escolha os momentos mais √≠ntimos que voc√™ deseja viver com o seu parceiro(a)
                            </p>
                        </div>

                        <!-- Categories -->
                        <div class="flex flex-wrap justify-center gap-3 mb-12">
                            <button onclick="filtrarMomentos(null)" 
                                class="px-4 py-2 rounded-full transition-all ${!state.filtro ? 
                                    'bg-pink1-600 text-white shadow-lg ring-2 ring-pink-500/50' : 
                                    'bg-gray-800 text-gray-300 hover:bg-gray-700'}" 
                                style="background: ${!state.filtro ? 'linear-gradient(45deg, #FF3547 0%, #FF6B7B 100%)' : ''}">
                                Todos
                            </button>
                            ${categorias.map(cat => `
                                <button onclick="filtrarMomentos('${cat.nome}')" 
                                    class="px-4 py-2 rounded-full transition-all ${state.filtro === cat.nome ? 
                                        'text-white shadow-lg' : 
                                        'text-gray-300 hover:bg-gray-800/50'} ${cat.color}">
                                    ${cat.emoji} ${cat.nome}
                                </button>
                            `).join('')}
                        </div>

                        <!-- Products Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
                            ${(state.filtro ? momentos.filter(m => m.categoria === state.filtro) : momentos).map(momento => `
                                <div class="product-card group">
                                    <div class="relative overflow-hidden">
                                        <img src="${momento.img}" alt="${momento.nome}" class="product-img group-hover:scale-105 transition-transform duration-300">
                                        <span class="product-badge">${momento.emoji} ${momento.categoria}</span>
                                    </div>
                                    <div class="p-4">
                                        <h3 class="font-medium">${momento.nome}</h3>
                                        <div class="mb-2">
                                            <div class="flex items-center gap-1">
                                                <span class="text-gray-500 text-sm">Intensidade:</span>
                                                <span class="text-pink-400">${'üî•'.repeat(momento.intensidade)}</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center mt-4">
                                            <button onclick="adicionarAoCarrinho(${JSON.stringify(momento).replace(/"/g, '&quot;')})" 
                                                class="text-sm bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white px-4 py-2 rounded-lg transition">
                                                Adicionar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </main>

                    <!-- Cart Sidebar (appears when items in cart) -->
                    ${state.carrinho.length > 0 && `
                        <div class="fixed inset-0 bg-black/50 z-20" onclick="renderMain()"></div>
                        <div class="fixed right-0 top-0 h-full w-full sm:w-96 bg-gray-900 z-30 border-l border-gray-800 p-6 overflow-y-auto" onclick="event.stopPropagation()">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold">Meu Carrinho (${state.carrinho.length}/2)</h3>
                                <button onclick="toggleCart()" class="text-gray-400 hover:text-white">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <div class="space-y-3">
                                ${state.carrinho.map((item, index) => `
                                    <div class="bg-gray-800/50 rounded-lg p-4 flex justify-between items-center">
                                        <div>
                                            <h4 class="font-medium">${item.emoji} ${item.nome}</h4>
                                            <small class="text-gray-400 text-sm">${item.categoria}</small>
                                        </div>
                                        <button onclick="removerDoCarrinho(${index})" class="text-red-400 hover:text-red-300">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="mt-8 pt-6 border-t border-gray-800">
                                <button onclick="finalizarPedido()" 
                                    class="w-full py-3 bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white rounded-lg font-medium transition-all">
                                    Finalizar Pedido
                                </button>
                                <button onclick="toggleCart()" class="w-full mt-4 py-2 text-gray-300 hover:text-white transition">
                                    Continuar Comprando
                                </button>
                            </div>
                        </div>
                    `}
                </div>
            `;
        }

function salvarUsuarioFirestore(usuario) {
  console.log('Tentando salvar usu√°rio no Firestore:', usuario);

  db.collection('usuarios').doc(usuario.codigo).set({
    nome: usuario.nome,
    telefone: usuario.telefone,
    email: usuario.email,
    sexo: usuario.sexo
  })
  .then(() => {
    console.log("Usu√°rio salvo com sucesso no Firestore!");
  })
  .catch(error => {
    console.error("Erro ao salvar usu√°rio no Firestore:", error);
  });
}

        // Event handlers
        function handleLogin() {
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const telefone = document.getElementById('telefone').value;
            const senha = document.getElementById('senha').value;
            const sexo = document.getElementById('sexo').value;

            if (!nome || !email || !telefone || !senha || !sexo) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            state.usuario = { nome, email, telefone, sexo };
            salvarUsuarioFirestore(state.usuario);
            state.etapa = 'parear';
            renderPareamento();
        }

        function handleContinuarSemParear() {
            state.etapa = 'main';
            renderMain();
        }

        function filtrarMomentos(categoria) {
            state.filtro = categoria;
            renderMain();
        }

        function adicionarAoCarrinho(momento) {
            if (state.carrinho.length >= 2) {
                const animElement = document.createElement('div');
                animElement.innerHTML = `
                    <div class="fixed bottom-10 right-10 bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg animate-bounce">
                        Limite de 2 itens no carrinho!
                    </div>
                `;
                document.body.appendChild(animElement);
                setTimeout(() => animElement.remove(), 2000);
                return;
            }
            
            state.carrinho = [...state.carrinho, momento];
            
            // Anima√ß√£o de adi√ß√£o
            const animElement = document.createElement('div');
            animElement.innerHTML = `
                <div class="fixed bottom-10 right-10 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg animate-bounce">
                    ${momento.emoji} ${momento.nome} adicionado!
                </div>
            `;
            document.body.appendChild(animElement);
            setTimeout(() => animElement.remove(), 2000);
            
            renderMain();
        }

        function removerDoCarrinho(index) {
            state.carrinho = state.carrinho.filter((_, i) => i !== index);
            
            // Anima√ß√£o de remo√ß√£o
            const animElement = document.createElement('div');
            animElement.innerHTML = `
                <div class="fixed bottom-10 right-10 bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg animate-bounce">
                    Item removido do carrinho
                </div>
            `;
            document.body.appendChild(animElement);
            setTimeout(() => animElement.remove(), 2000);
            
            renderMain();
        }

        function desparearParceiro() {
            if (confirm('Tem certeza que deseja desfazer o pareamento?')) {
                state.pareado = false;
                state.parceiroCodigo = null;
                state.parceiroTelefone = null;
                state.showPartnerInfo = false;
                renderMain();
            }
        }

        function finalizarPedido() {
            if (!state.pareado) {
                alert('Voc√™ precisa estar pareado com seu parceiro(a) para finalizar o pedido.');
                return;
            }
            if (state.carrinho.length === 0) {
                alert('Seu carrinho est√° vazio.');
                return;
            }
            
            const momentos = state.carrinho.map(m => `${m.emoji} ${m.nome}`).join(' | ');
            const mensagem = encodeURIComponent(`üíë Pedido de Momentos Especiais üíë\n\nMeus momentos escolhidos:\n${momentos}\n\n‚úâÔ∏è Entrega pessoal requerida! üòä`);
            
            // Usa o telefone do parceiro armazenado
            // Garante formato internacional (55) para WhatsApp
            const telefoneWhatsapp = state.parceiroTelefone.startsWith('55') ? 
                state.parceiroTelefone : 
                '55' + state.parceiroTelefone.replace(/\D/g, '');
            const whatsappLink = `https://wa.me/${telefoneWhatsapp}?text=${mensagem}`;
            
            // Animation
            const animElement = document.createElement('div');
            animElement.innerHTML = `
                <div class="fixed bottom-10 right-10 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg animate-bounce">
                    <i class="fas fa-paper-plane"></i> Abrindo WhatsApp com seu parceiro...
                </div>
            `;
            document.body.appendChild(animElement);
            setTimeout(() => {
                animElement.remove();
                window.open(whatsappLink, '_blank');
            }, 1500);
            
            state.carrinho = [];
            renderMain();
        }

        // Cart toggle function
        function toggleCart() {
            state.carrinho = []; // Limpa o carrinho ao fechar
            renderMain(); // Re-renderiza a p√°gina principal sem o carrinho
        }

        // Initialize app
        function init() {
            renderLogin();
        }

        // Start the app
        window.onload = function() {
            // Make functions global for onclick events
            window.handleLogin = handleLogin;
            window.validarCodigo = validarCodigo;
            window.handleContinuarSemParear = handleContinuarSemParear;
            window.filtrarMomentos = filtrarMomentos;
            window.adicionarAoCarrinho = adicionarAoCarrinho;
            window.removerDoCarrinho = removerDoCarrinho;
            window.finalizarPedido = finalizarPedido;
            window.desparearParceiro = desparearParceiro;
            
            init();
        };
    </script>
<footer style="
    text-align: center;
    padding: 16px;
    font-size: 14px;
    color: #888;
    background-color: #f4f4f4;
    margin-top: 40px;
    border-top: 1px solid #ddd;
">
    ¬© 2025 Nosso Momento. Todos os direitos reservados.
</footer>
</body>
</html>